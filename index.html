<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Weather ‚Äî Current Conditions (OpenWeatherMap)</title>
  <style>
    :root{
      --bg:#071225; --card:#0e1722; --muted:#9aa6b2; --accent:#00c8ff;
      font-family:Inter, system-ui, -apple-system, "Segoe UI", Roboto, Arial;
    }
    *{box-sizing:border-box}
    html,body{height:100%;margin:0;background:linear-gradient(180deg,#041022,#071227);color:#e9f3f8}
    .wrap{min-height:100vh;display:flex;align-items:center;justify-content:center;padding:28px}
    .card{width:min(820px,96%);background:linear-gradient(180deg,var(--card),#071029);border-radius:14px;padding:18px;box-shadow:0 14px 40px rgba(0,0,0,0.6)}
    h1{margin:0;font-size:20px}
    .controls{display:flex;gap:8px;margin-top:12px;align-items:center;flex-wrap:wrap}
    input[type="text"]{flex:1;min-width:180px;padding:10px;border-radius:10px;border:1px solid rgba(255,255,255,0.04);background:transparent;color:inherit}
    button{padding:10px 12px;border-radius:10px;border:none;background:linear-gradient(90deg,var(--accent),#6ee7b7);color:#042;font-weight:800;cursor:pointer}
    .secondary{background:transparent;border:1px solid rgba(255,255,255,0.06);color:var(--muted);font-weight:700}
    select{padding:8px;border-radius:8px;background:transparent;border:1px solid rgba(255,255,255,0.04);color:inherit}
    .status{margin-top:12px;color:var(--muted);font-size:14px}
    .weather-grid{display:grid;grid-template-columns:180px 1fr;gap:18px;margin-top:18px;align-items:center}
    .icon{width:160px;height:160px;border-radius:12px;background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));display:flex;align-items:center;justify-content:center;font-size:44px}
    .details{display:flex;flex-direction:column;gap:8px}
    .big-temp{font-size:44px;font-weight:800}
    .meta{display:flex;gap:12px;flex-wrap:wrap;color:var(--muted)}
    .row{display:flex;justify-content:space-between;align-items:center}
    .loader{display:inline-block;width:18px;height:18px;border-radius:50%;border:3px solid rgba(255,255,255,0.08);border-top-color:var(--accent);animation:spin 1s linear infinite}
    @keyframes spin{to{transform:rotate(360deg)}}
    .note{font-size:13px;color:var(--muted);margin-top:10px}
    @media (max-width:720px){.weather-grid{grid-template-columns:1fr;grid-auto-rows:auto}.icon{width:120px;height:120px}}
  </style>
</head>
<body>
  <div class="wrap">
    <div class="card" role="application" aria-label="Weather app">
      <h1>Weather ‚Äî Current Conditions</h1>

      <div class="controls" aria-hidden="false">
        <input id="placeInput" type="text" placeholder="Enter city or place (e.g. New Delhi)" aria-label="Location" />
        <button id="searchBtn" class="">Search</button>
        <button id="locBtn" class="secondary">Use My Location</button>
        <select id="unitSelect" title="Units" aria-label="Units">
          <option value="metric">¬∞C</option>
          <option value="imperial">¬∞F</option>
        </select>
      </div>

      <div id="status" class="status" aria-live="polite">Enter a city or click "Use My Location".</div>

      <div id="weatherCard" class="weather-grid" style="display:none" role="region" aria-label="Current weather">
        <div class="icon" id="iconEl" aria-hidden="true">‚òÄÔ∏è</div>
        <div class="details">
          <div class="row">
            <div>
              <div id="placeTitle" style="font-weight:800;font-size:18px">‚Äî</div>
              <div id="desc" class="meta">‚Äî</div>
            </div>
            <div style="text-align:right">
              <div class="big-temp" id="tempEl">--</div>
              <div id="feelsEl" class="meta">Feels like ‚Äî</div>
            </div>
          </div>

          <div class="meta" id="extra">
            <div>Wind: <span id="wind">‚Äî</span></div>
            <div>Humidity: <span id="humidity">‚Äî</span></div>
            <div>Pressure: <span id="pressure">‚Äî</span></div>
            <div>Sunrise: <span id="sunrise">‚Äî</span></div>
            <div>Sunset: <span id="sunset">‚Äî</span></div>
          </div>

          <div class="note">Powered by OpenWeatherMap. API key is included in this page for local testing. Remove or proxy the key before publishing publicly.</div>
        </div>
      </div>

    </div>
  </div>

  <script>
    // ========== CONFIG ==========
    // Your OpenWeatherMap API key (you provided it)
    const API_KEY = '5fce1fd77b28607fe0e63d88e268d8e0';

    // ========== ELEMENTS ==========
    const placeInput = document.getElementById('placeInput');
    const searchBtn = document.getElementById('searchBtn');
    const locBtn = document.getElementById('locBtn');
    const unitSelect = document.getElementById('unitSelect');
    const statusEl = document.getElementById('status');
    const weatherCard = document.getElementById('weatherCard');
    const iconEl = document.getElementById('iconEl');
    const placeTitle = document.getElementById('placeTitle');
    const descEl = document.getElementById('desc');
    const tempEl = document.getElementById('tempEl');
    const feelsEl = document.getElementById('feelsEl');
    const windEl = document.getElementById('wind');
    const humidityEl = document.getElementById('humidity');
    const pressureEl = document.getElementById('pressure');
    const sunriseEl = document.getElementById('sunrise');
    const sunsetEl = document.getElementById('sunset');

    // ========== HELPERS ==========
    function showStatus(text, busy=false){
      statusEl.innerHTML = busy ? `<span class="loader" aria-hidden="true"></span> ${text}` : text;
    }
    function showError(text){ weatherCard.style.display='none'; showStatus(text); }

    function fmtTimeUnix(sec, tzOffsetSeconds=0){
      if(!sec) return '‚Äî';
      // OpenWeatherMap returns unix UTC seconds for sunrise/sunset (in 'sys')
      const dt = new Date((sec + tzOffsetSeconds) * 1000);
      return dt.toLocaleTimeString([], {hour:'2-digit', minute:'2-digit'});
    }

    // capitalize description
    function cap(s){ return s ? s.charAt(0).toUpperCase() + s.slice(1) : ''; }

    // ========== API CALLS ==========
    // Fetch by city name (q)
    async function fetchByCity(q, units='metric'){
      showStatus('Searching location‚Ä¶', true);
      try {
        const url = `https://api.openweathermap.org/data/2.5/weather?q=${encodeURIComponent(q)}&units=${units}&appid=${API_KEY}`;
        const res = await fetch(url);
        if (!res.ok) {
          if(res.status === 404) throw new Error('Location not found');
          throw new Error('Weather API error: ' + res.status);
        }
        const data = await res.json();
        renderFromOWM(data, units);
      } catch (err) {
        console.error(err);
        showError('Could not fetch weather: ' + (err.message || err));
      }
    }

    // Fetch by coords (lat, lon)
    async function fetchByCoords(lat, lon, units='metric'){
      showStatus('Fetching weather for your location‚Ä¶', true);
      try {
        const url = `https://api.openweathermap.org/data/2.5/weather?lat=${lat}&lon=${lon}&units=${units}&appid=${API_KEY}`;
        const res = await fetch(url);
        if (!res.ok) throw new Error('Weather API error: ' + res.status);
        const data = await res.json();
        renderFromOWM(data, units);
      } catch (err) {
        console.error(err);
        showError('Could not fetch weather: ' + (err.message || err));
      }
    }

    // ========== RENDER ==========
    function renderFromOWM(data, units){
      if(!data) { showError('No data'); return; }
      weatherCard.style.display = 'grid';

      const name = `${data.name || ''}${data.sys && data.sys.country ? ', ' + data.sys.country : ''}`;
      const desc = data.weather && data.weather[0] ? cap(data.weather[0].description) : '‚Äî';
      const iconCode = data.weather && data.weather[0] ? data.weather[0].icon : null;
      const temp = Math.round(data.main?.temp ?? NaN);
      const feels = Math.round(data.main?.feels_like ?? NaN);
      const wind = data.wind ? `${Math.round(data.wind.speed)} ${units === 'metric' ? 'm/s' : 'mph'}` : '‚Äî';
      const humidity = data.main?.humidity ? data.main.humidity + '%' : '‚Äî';
      const pressure = data.main?.pressure ? data.main.pressure + ' hPa' : '‚Äî';
      const sunrise = data.sys?.sunrise ? fmtTimeUnix(data.sys.sunrise, data.timezone || 0) : '‚Äî';
      const sunset = data.sys?.sunset ? fmtTimeUnix(data.sys.sunset, data.timezone || 0) : '‚Äî';

      placeTitle.textContent = name || '‚Äî';
      descEl.textContent = desc;
      tempEl.textContent = `${temp} ${units === 'metric' ? '¬∞C' : '¬∞F'}`;
      feelsEl.textContent = isNaN(feels) ? '' : `Feels like ${feels} ${units === 'metric' ? '¬∞C' : '¬∞F'}`;
      windEl.textContent = wind;
      humidityEl.textContent = humidity;
      pressureEl.textContent = pressure;
      sunriseEl.textContent = sunrise;
      sunsetEl.textContent = sunset;

      if(iconCode){
        iconEl.innerHTML = `<img alt="${desc} icon" src="https://openweathermap.org/img/wn/${iconCode}@2x.png" style="width:100%;height:100%;object-fit:contain" />`;
      } else {
        iconEl.textContent = 'üå§Ô∏è';
      }

      showStatus(`Updated ‚Äî ${new Date().toLocaleTimeString()}. Source: OpenWeatherMap`);
    }

    // ========== UI BINDINGS ==========
    searchBtn.addEventListener('click', () => {
      const q = placeInput.value.trim();
      if(!q){ showError('Please enter a city or place.'); return; }
      fetchByCity(q, unitSelect.value);
    });

    placeInput.addEventListener('keydown', (e) => {
      if(e.key === 'Enter') searchBtn.click();
    });

    locBtn.addEventListener('click', () => {
      if(!navigator.geolocation){ showError('Geolocation not supported in this browser.'); return; }
      showStatus('Getting your location‚Ä¶', true);
      navigator.geolocation.getCurrentPosition(async (pos) => {
        const { latitude:lat, longitude:lon } = pos.coords;
        await fetchByCoords(lat, lon, unitSelect.value);
      }, (err) => {
        console.error(err); showError('Unable to get location: permission denied or unavailable.'); 
      }, { enableHighAccuracy: true, timeout: 10000 });
    });

    unitSelect.addEventListener('change', () => {
      // re-run current query if visible
      if(weatherCard.style.display === 'grid'){
        const q = placeInput.value.trim();
        if(q) fetchByCity(q, unitSelect.value);
        else showStatus('Units changed. Use "Use My Location" or search to update weather with the new unit.');
      }
    });

    // Optional: initialize with user's location on load (comment/uncomment as desired)
    // navigator.geolocation && navigator.geolocation.getCurrentPosition(p => fetchByCoords(p.coords.latitude, p.coords.longitude, 'metric'));

  </script>
</body>
</html>
